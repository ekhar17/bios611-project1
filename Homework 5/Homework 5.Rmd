---
title: "Homework 5"
author: "Elena Kharitonova"
date: "10/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r, include = FALSE}
library(tidyverse)
library(gbm)
```

## Question 1 : Redo GBM Model on New Data Set

First the data needs to be loaded.
```{r}
weight_height = read.csv("weight-height.csv")
```

Next, we will choose 70% of the data to be used for training the model, 15% of the data for validating the model and tuning the parameters, and 15% of the data for testing the model. Upon inspection, the data is arranged first all males, then all females, so first the order of the rows in the data set will be randomized, then we will assign the first 7000 entries to the training data set, the next 1500 entries to the validation data set, and the last 1500 entries to the testing data set. 

```{r}
## Randomize order of rows in the dataset
weight_height = weight_height[sample(nrow(weight_height), nrow(weight_height)),]

## Assign to Training, Validation, and Test set
set = c(rep("Train", 7000), rep("Validate", 1500), rep ("Test", 1500))
weight_height = weight_height %>% mutate(set = set)
```

Next, we need to transform the gender variable into a set of 0's and 1's, so that we can use it in our model. Thus, female will take on the value of 1, and male will take on the value of female

```{r}
female = weight_height$Gender == "Female"
weight_height = weight_height %>% mutate(female = female)
```


Now we are ready to create our GBM model. The summary of the model is displayed below

```{r}
model.gbm <- gbm(female ~ Height + Weight,
                 weight_height %>% filter(set == "Train"),
                 n.trees = 100,
                 interaction.depth = 2,
                 shrinkage=0.1, distribution = "bernoulli")
summary(model.gbm)
```

In order to test the accuracy of our model, we first need to apply our model to the non-training data. Since we do not do any model selection, since the rest of the assignment uses a different data set, we will test the data on both the validating and testing data set. 

```{r, results = 'hide'}
test <- weight_height %>% filter(set != "Train");
test$female.p1 <- predict(model.gbm, test, type="response")
```
The accuracy of the model is displayed below. (It is the value on the left). This is compared to the accuracy simplest model possible, which guesses male for all of the data (this is the value on the right.

```{r}
gbm.accur = c(sum((test$female.p1>0.5)==test$female)/nrow(test),sum(FALSE==test$female)/nrow(test))
data.frame("GBM_Accuracy" = gbm.accur[1], "Simplest_Model_Accuracy" = gbm.accur[2])
```

Our GBM model has a much higher accuracy than the the simplest model that always guesses male. Additionally, it has a much higher accuracy than the GBM model made in the previous homework assignment which had an accuracy of about 52%. It is not surprising that this new GBM model has a much higher accuracy because it was used on a data set of real people with real genders, heights, and weights as opposed to those that were randomly generated. Therefore, in this data set the label of female and male had a correlation with the height and weight provided, while the old data set did not. That is why this model is able to predict the gender based on the height and weight with a much higher accuracy than that in the previous homework could. 
